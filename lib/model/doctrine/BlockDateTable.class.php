<?php

/**
 * BlockDateTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class BlockDateTable extends Doctrine_Table
{
    const BLOCK_PAYMENT = 'BLOCK_PAYMENT';
    const ACTIVE = 1;
    const NOT_ACTIVE = 0;
    /**
     * Returns an instance of this class.
     *
     * @return object BlockDateTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('BlockDate');
    }
    
    public static function getBlockTypes() 
    {
        $type = array(
            'BLOCK_PAYMENT' => 'Төлбрийн хаалт',
        );
        return $type;
    }
    
    public static function getList() {
        
        $q = Doctrine_Query::create()
                ->from('BlockDate')
                ->orderBy('id');
        
        return $q->fetchArray();
    }
    
    public static function getByType($type = self::BLOCK_PAYMENT, $isActive = 0) {
        
        $q = Doctrine_Query::create()
                ->from('BlockDate')
                ->where('block_type = ?', $type);
        if ($isActive)
            $q->addWhere ('is_active = ?', self::ACTIVE);
        return $q->fetchOne();
    }
    
    public static function setValue(&$row, $blockDate, $blockType, $active, $userId) {
        $row->setBlockType($blockType);
        $row->setBlockDate($blockDate);
        $row->setIsActive($active);
        $row->setCreatedUserId($userId);
        $row->setCreatedAt(date('Y-m-d H:i:s'));
        $row->save();
    }
    
    public static function update($id, $block_Date, $block_type, $active, $user_id) {
        $row = self::getInstance()->find($id);
        if(!$row) { 
            $row = new BlockDate();
        }
        self::setValue($row, $block_Date, $block_type, $active, $user_id);
        return $row;
    }
    
    public static function checkBlock($date, $type = self::BLOCK_PAYMENT) {
        $block = self::getByType($type, self::ACTIVE);
        return $block['block_date'] >= $date; 
    }
}